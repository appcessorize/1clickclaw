# Nixpacks configuration for Coolify deployment

[phases.setup]
nixPkgs = ["ruby_3_3", "nodejs_20", "postgresql"]

[phases.install]
cmds = [
    "bundle install",
    "bun install"
]

[phases.build]
cmds = [
    "bundle exec rails assets:precompile",
    "bun run build:css"
]

[start]
cmd = "bundle exec rails db:migrate && bundle exec puma -C config/puma.rb"

[variables]
RAILS_ENV = "production"
RAILS_LOG_TO_STDOUT = "true"
RAILS_SERVE_STATIC_FILES = "true"
