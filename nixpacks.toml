# Nixpacks configuration for Coolify deployment

[phases.setup]
# Let Nixpacks auto-detect Ruby and Node.js to avoid conflicts
aptPkgs = ["libpq-dev"]

[phases.install]
cmds = [
    "npm install -g yarn",
    "bundle install",
    "yarn install",
    "npm install -g @tailwindcss/cli"
]

[phases.build]
cmds = [
    "npx @tailwindcss/cli -i ./app/assets/stylesheets/application.tailwind.css -o ./app/assets/builds/application.css --minify",
    "bundle exec rails assets:precompile"
]

[start]
cmd = "bundle exec rails db:migrate && bundle exec puma -C config/puma.rb"

[variables]
RAILS_ENV = "production"
RAILS_LOG_TO_STDOUT = "true"
RAILS_SERVE_STATIC_FILES = "true"
