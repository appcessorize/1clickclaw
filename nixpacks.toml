# Nixpacks configuration for Coolify deployment

[phases.setup]
nixPkgs = ["postgresql_15"]
aptPkgs = ["libpq-dev", "libyaml-dev", "libffi-dev", "libreadline-dev", "zlib1g-dev", "libssl-dev", "autoconf", "bison", "rustc", "cargo"]

[phases.build]
cmds = [
    "npm install -g yarn",
    "yarn install",
    "SECRET_KEY_BASE_DUMMY=1 bundle exec rails assets:precompile"
]

[start]
cmd = "bundle exec rails db:migrate && bundle exec puma -C config/puma.rb"

[variables]
RAILS_ENV = "production"
RAILS_LOG_TO_STDOUT = "true"
RAILS_SERVE_STATIC_FILES = "true"
